---
const ulr = import.meta.env.REGISTER_URL;
---

<!-- TODO TOAST DE INFORMACION DE ERRORES --><!--Formulario de Registro -->
<div class="h-[90vh] flex items-center justify-center">
	<form
		class="w-full max-w-xl space-y-20 bg-gray-100 dark:bg-[#0f1011] p-4 rounded-lg shadow-lg dark:shadow-lg/100 text-black"
		id="register-form"
	>
		<h2 class="text-2xl font-bold text-center dark:text-white text-black">
			Registrarse
		</h2>

		<div>
			<label
				for="name"
				class="block text-sm font-medium text-gray-700 dark:text-white"
				>Nombre</label
			>
			<input
				type="text"
				name="name"
				id="name"
				required
				class="dark:bg-white mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
			/>
		</div>

		<div>
			<label
				for="email"
				class="block text-sm font-medium text-gray-700 dark:text-white"
				>Email</label
			>
			<input
				type="email"
				name="email"
				id="email"
				required
				class="dark:bg-white mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
			/>
		</div>

		<div>
			<label
				for="password"
				class="block text-sm font-medium text-gray-700 dark:text-white"
				>Contraseña</label
			>
			<input
				type="password"
				name="password"
				id="password"
				required
				class="dark:bg-white mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
			/>
		</div>

		<button
			type="submit"
			class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors font-semibold"
		>
			Registrarse
		</button>

		<p class="text-center text-sm text-gray-700 dark:text-gray-300 mt-4">
			Ya tienes una cuenta?
			<a
				href="/login"
				class="text-[#0348DD] hover:text-[#729EFD] dark:text-[#78A2FC] dark:hover:text-[#AFC8FD] transition-colors"
				>Inicia sesión</a
			>
		</p>
	</form>
</div>

<!-- Script que envia el formulario y usa fetch -->
<script>
	const form = document.getElementById("register-form");

	form?.addEventListener("submit", async (event) => {
		event.preventDefault();

		const formData = new FormData(form);
		const data = Object.fromEntries(formData.entries());

		try {
			const response = await fetch(import.meta.env.PUBLIC_REGISTER_URL, {
				method: "post",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify(data),
			});

			if (response.ok) {
				//se redirije al usuario a /login
				console.log("user added");
				//localStorage.setItem("isAuth", "true");
				window.location.href = "/login";
			} else {
				alert("TODO:REVISAR DIFERENTES MENSAJES");
			}
		} catch (error) {
			console.error("Error de red:", error);
			alert("No se pudo conectar con el servidor.");
		}
	});
</script>
